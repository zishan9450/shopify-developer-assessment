{% comment %}
  Subscription Product Template - Image-matched UI
{% endcomment %}

<div class="subscription-product-container">
  <!-- Product Gallery Section -->
  <div class="product-gallery-section">
    <div class="main-image-wrapper">
      <img 
        id="main-product-image" 
        src="{{ product.featured_image | image_url: width: 800 }}" 
        alt="{{ product.title }}"
        loading="lazy"
        width="800"
        height="800"
      >
      <div class="image-overlay">
        <button class="gallery-nav prev" id="prev-image">‹</button>
        <button class="gallery-nav next" id="next-image">›</button>
      </div>
    </div>

    <div class="carousel-dots" id="carousel-dots">
      {% for image in product.images %}
        <div class="dot {% if forloop.first %}active{% endif %}" data-index="{{ forloop.index0 }}"></div>
      {% endfor %}
    </div>

    <div class="thumbnail-gallery">
      {% for image in product.images %}
        <div class="thumbnail-item {% if forloop.first %}active{% endif %}" 
             data-image="{{ image | image_url: width: 800 }}"
             data-index="{{ forloop.index0 }}">
          <img src="{{ image | image_url: width: 150 }}" 
               alt="{{ image.alt | default: product.title }}"
               loading="lazy"
               width="150"
               height="150">
        </div>
      {% endfor %}
    </div>
  </div>

  <!-- Product Details Section -->
  <div class="product-details-section">
    <h1 class="product-title">{{ product.title }}</h1>
    
    <!-- Ratings Section -->
    <div class="product-ratings">
      <div class="stars">
        <span class="star filled">★</span>
        <span class="star filled">★</span>
        <span class="star filled">★</span>
        <span class="star filled">★</span>
        <span class="star filled">★</span>
        <span class="rating-number">4.6</span>
        <span class="review-count">(2,000+ reviews)</span>
      </div>
    </div>
    
    <p class="product-description">Choose your perfect drink subscription with our premium selection of flavors.</p>

    <!-- Subscription Cards -->
    <div class="subscription-cards">

      <!-- Single Subscription (Default Open + Recommended) -->
      <section class="sub-card single-option active is-open" data-type="single" aria-expanded="true">
        <div class="recommended-strip">Recommended</div>
        <header class="sub-card-header">
          <label class="sub-card-radio">
            <input type="radio" name="subscription-type" value="single" checked aria-label="Single Drink Subscription">
            <span class="radio-visual"></span>
            <span class="sub-card-title">{{ product.metafields.subscription.single_title | default: 'Single Drink Subscription' }}</span>
          </label>
          <div class="sub-card-price">
            <span class="now">Rs.<span class="current-price">{{ product.price | divided_by: 100.0 | times: 0.75 | times: 0.8 | round: 2 }}</span></span>
            <span class="was">Rs.<span class="original-price">{{ product.price | divided_by: 100.0 }}</span></span>
          </div>
        </header>

        <div class="sub-card-divider"></div>

        <div class="sub-card-body option-details">
          <h3 class="mini-heading">Choose Flavor</h3>
          <div class="flavor-row" id="flavor-1">
            {% for variant in product.variants %}
              <button type="button"
                      class="flavor-card {% if forloop.first %}selected{% endif %}"
                      data-variant-id="{{ variant.id }}"
                      data-flavor="{{ variant.title | downcase }}"
                      data-price="{{ variant.price | divided_by: 100.0 }}">
                <span class="flavor-radio"></span>
                <div class="flavor-thumb">
                  <img src="{{ variant.image | default: product.featured_image | image_url: width: 160 }}" alt="{{ variant.title }}" width="160" height="160">
                </div>
                <span class="flavor-name">{{ variant.title }}</span>
                {% if forloop.first %}
                  <span class="pill best-seller">BEST SELLER</span>
                {% endif %}
              </button>
            {% endfor %}
          </div>

          <h3 class="mini-heading">What's Included:</h3>
          <div class="included-tiles">
            <div class="included-tile">
              <div class="tile-head">
                <span class="tile-title">Every 30 Days</span>
              </div>
              <div class="tile-images">
                {% for image in product.images limit:3 %}
                  <img src="{{ image | image_url: width: 120 }}" alt="{{ image.alt | default: product.title }}" width="60" height="100">
                {% endfor %}
              </div>
            </div>
            <div class="included-tile">
              <div class="tile-head">
                <span class="tile-title">One Time</span>
                <span class="tile-free">(Free)</span>
              </div>
              <div class="tile-images">
                {% for image in product.images limit:3 %}
                  <img src="{{ image | image_url: width: 120 }}" alt="{{ image.alt | default: product.title }}" width="60" height="100">
                {% endfor %}
              </div>
            </div>
          </div>

          <ul class="checklist" id="included-content-single"></ul>
        </div>
      </section>

      <!-- Double Subscription (Collapsed) -->
      <section class="sub-card double-option" data-type="double" aria-expanded="false">
        <header class="sub-card-header">
          <label class="sub-card-radio">
            <input type="radio" name="subscription-type" value="double" aria-label="Double Drink Subscription">
            <span class="radio-visual"></span>
            <span class="sub-card-title">{{ product.metafields.subscription.double_title | default: 'Double Drink Subscription' }}</span>
          </label>
          <div class="sub-card-price">
            <span class="now">Rs.<span class="current-price">{{ product.price | divided_by: 100.0 | times: 1.5 | times: 0.75 | times: 0.8 | round: 2 }}</span></span>
            <span class="was">Rs.<span class="original-price">{{ product.price | divided_by: 100.0 | times: 1.5 }}</span></span>
          </div>
        </header>

        <div class="sub-card-divider"></div>

        <div class="sub-card-body option-details" style="display:none">
          <h3 class="mini-heading">Choose Flavor</h3>
          <div class="double-flavors">
            <div class="double-col">
              <p class="double-tag">Flavor 1</p>
              <div class="flavor-row" id="flavor-1-double">
                {% for variant in product.variants %}
                  <button type="button"
                          class="flavor-card"
                          data-variant-id="{{ variant.id }}"
                          data-flavor="{{ variant.title | downcase }}"
                          data-price="{{ variant.price | divided_by: 100.0 }}">
                    <span class="flavor-radio"></span>
                    <div class="flavor-thumb">
                      <img src="{{ variant.image | default: product.featured_image | image_url: width: 160 }}" alt="{{ variant.title }}" width="160" height="160">
                    </div>
                    <span class="flavor-name">{{ variant.title }}</span>
                  </button>
                {% endfor %}
              </div>
            </div>
            <div class="double-col">
              <p class="double-tag">Flavor 2</p>
              <div class="flavor-row" id="flavor-2-double">
                {% for variant in product.variants %}
                  <button type="button"
                          class="flavor-card"
                          data-variant-id="{{ variant.id }}"
                          data-flavor="{{ variant.title | downcase }}"
                          data-price="{{ variant.price | divided_by: 100.0 }}">
                    <span class="flavor-radio"></span>
                    <div class="flavor-thumb">
                      <img src="{{ variant.image | default: product.featured_image | image_url: width: 160 }}" alt="{{ variant.title }}" width="160" height="160">
                    </div>
                    <span class="flavor-name">{{ variant.title }}</span>
                  </button>
                {% endfor %}
              </div>
            </div>
          </div>

          <h3 class="mini-heading">What's Included:</h3>
          <div class="included-tiles">
            <div class="included-tile">
              <div class="tile-head">
                <span class="tile-title">Every 30 Days</span>
              </div>
              <div class="tile-images">
                {% for image in product.images limit:3 %}
                  <img src="{{ image | image_url: width: 120 }}" alt="{{ image.alt | default: product.title }}" width="60" height="100">
                {% endfor %}
              </div>
            </div>
            <div class="included-tile">
              <div class="tile-head">
                <span class="tile-title">One Time</span>
                <span class="tile-free">(Free)</span>
              </div>
              <div class="tile-images">
                {% for image in product.images limit:3 %}
                  <img src="{{ image | image_url: width: 120 }}" alt="{{ image.alt | default: product.title }}" width="60" height="100">
                {% endfor %}
              </div>
            </div>
          </div>

          <ul class="checklist" id="included-content-double"></ul>
        </div>
      </section>
    </div>

    <!-- Add to Cart -->
    <div class="add-to-cart-section">
      <div class="quantity-selector">
        <label for="quantity">Quantity:</label>
        <select id="quantity" name="quantity">
          <option value="1" selected>1</option>
          <option value="2">2</option><option value="3">3</option>
          <option value="4">4</option><option value="5">5</option>
        </select>
      </div>

      <button id="add-to-cart-btn" class="add-to-cart-button" disabled>
        <span class="button-text">Add to Cart</span>
        <span class="button-price">Rs.<span id="final-price">{{ product.price | divided_by: 100.0 | times: 0.75 | times: 0.8 | round: 2 }}</span></span>
      </button>
      <div class="cart-message" id="cart-message"></div>
    </div>
  </div>
</div>

<!-- Data for JS -->
<script type="application/json" id="product-data">
{
  "id": {{ product.id }},
  "title": {{ product.title | json }},
  "price": {{ product.price }},
  "compare_at_price": {{ product.compare_at_price | default: product.price }},
  "metafields": {
    "single_title": {{ product.metafields.subscription.single_title | json }},
    "double_title": {{ product.metafields.subscription.double_title | json }},
    "single_description": {{ product.metafields.subscription.single_description | json }},
    "double_description": {{ product.metafields.subscription.double_description | json }},
    "single_included": {{ product.metafields.subscription.single_included | json }},
    "double_included": {{ product.metafields.subscription.double_included | json }},
    "single_benefits": {{ product.metafields.subscription.single_benefits | json }},
    "double_benefits": {{ product.metafields.subscription.double_benefits | json }},
    "delivery_frequency": {{ product.metafields.subscription.delivery_frequency | json }}
  },
  "variants": [
    {% for variant in product.variants %}
    {
      "id": {{ variant.id }},
      "title": {{ variant.title | json }},
      "price": {{ variant.price }},
      "compare_at_price": {{ variant.compare_at_price | default: variant.price }},
      "image": {{ variant.image | image_url: width: 800 | json }},
      "available": {{ variant.available }}
    }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ],
  "images": [
    {% for image in product.images %}
    {
      "src": {{ image | image_url: width: 800 | json }},
      "alt": {{ image.alt | json }}
    }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ]
}
</script>